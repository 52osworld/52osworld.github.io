<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta><title>Yocto项目快速构建</title><link rel="stylesheet" type="text/css" href="https://www.yoctoproject.org/docs/2.5/brief-yoctoprojectqs/brief-yoctoprojectqs-style.css"></link><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"></meta><meta name="description" content=""></meta></head><body dir="ltr"><div class="article" title="Yocto项目快速构建"><div class="titlepage" xmlns=""><div><div><table border="0" cellspacing="0" cellpadding="0" width="540" xmlns="http://www.w3.org/1999/xhtml" summary="manufactured viewport for HTML img"><tr style="height:90px"><td align="right"><img src="https://www.yoctoproject.org/docs/2.5/brief-yoctoprojectqs/figures/yocto-project-transp.png" align="right" width="135"></td></tr></table></div><div><h2 class="title" xmlns="http://www.w3.org/1999/xhtml"><a id="brief-yocto-project-qs-intro"></a> 快速构建Yocto项目<span class="permalink"><a alt="永久链接" title="永久链接" href="https://www.yoctoproject.org/docs/2.5/brief-yoctoprojectqs/brief-yoctoprojectqs.html#brief-yocto-project-qs-intro">¶</a></span></h2></div><div><p class="copyright" xmlns="http://www.w3.org/1999/xhtml">版权所有©2010-2018 Linux基金会</p></div><div><div class="legalnotice" title="法律声明" xmlns="http://www.w3.org/1999/xhtml"><a id="idm46609068553024"></a><p>根据<a class="ulink" href="http://creativecommons.org/licenses/by-sa/2.0/uk/" target="_top">Creative Commons</a>出版的<a class="ulink" href="http://creativecommons.org/licenses/by-sa/2.0/uk/" target="_top">知识共享署名 - 相同方式共享2.0英国：英格兰和威尔士</a>条款，授予您复制，分发和/或修改本文档的权利。
            </p></div></div></div><hr></div><div class="section" title="欢迎！"><div class="titlepage" xmlns=""><div><div><h2 class="title" xmlns="http://www.w3.org/1999/xhtml" style="clear:both"><a id="brief-welcome"></a>欢迎！<span class="permalink"><a alt="永久链接" title="永久链接" href="https://www.yoctoproject.org/docs/2.5/brief-yoctoprojectqs/brief-yoctoprojectqs.html#brief-welcome">¶</a></span></h2></div></div></div><p>欢迎！这篇简短的文档将指导您完成使用Yocto项目进行基本镜像构建的过程。该文件还介绍了如何配置特定硬件的版本。您将使用Yocto Project构建一个名为Poky的参考嵌入式操作系统。
            </p><div class="note" title="注意" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3>本白皮书中的示例假设您正在使用运行最新Ubuntu Linux发行版的本机Linux系统。如果您想使用Yocto Project创建映像的机器不是本地Linux系统，则仍然可以通过使用CROss PlatformS（CROPS）并设置Poky容器来执行这些步骤。有关更多信息，请参考Yocto项目开发任务手册中的<a class="ulink" href="http://www.yoctoproject.org/docs/2.5/dev-manual/dev-manual.html#setting-up-to-use-crops" target="_top">设置以使用CROss PlatformS（CROPS）</a> “部分。
            </div><p>
        </p><p>如果您想了解Yocto项目的更多概念或背景信息，请参考<a class="ulink" href="http://www.yoctoproject.org/docs/2.5/overview-manual/overview-manual.html" target="_top">Yocto项目概述和概念手册</a> 。
        </p></div><div class="section" title="兼容的Linux发行版"><div class="titlepage" xmlns=""><div><div><h2 class="title" xmlns="http://www.w3.org/1999/xhtml" style="clear:both"><a id="brief-compatible-distro"></a>兼容Linux发行<span class="permalink"><a alt="永久链接" title="永久链接" href="https://www.yoctoproject.org/docs/2.5/brief-yoctoprojectqs/brief-yoctoprojectqs.html#brief-compatible-distro">¶</a></span></h2></div></div></div><p>确保您的<a class="ulink" href="http://www.yoctoproject.org/docs/2.5/ref-manual/ref-manual.html#hardware-build-system-term" target="_top">构建主机</a>满足以下要求：</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>50 GB可用磁盘空间</p></li><li class="listitem"><p>运行受支持的Linux发行版（即最新版本的Fedora，openSUSE，CentOS，Debian或Ubuntu）。有关支持Yocto项目的Linux发行版列表，请参考Yocto项目参考手册中的“ <a class="ulink" href="http://www.yoctoproject.org/docs/2.5/ref-manual/ref-manual.html#detailed-supported-distros" target="_top">支持的Linux发行版</a> ”部分。
                    </p></li><li class="listitem"><p>
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Git 1.8.3.1或更高版本</p></li><li class="listitem"><p>tar 1.27或更高</p></li><li class="listitem"><p>Python 3.4.0或更高版本。
                            </p></li></ul></div><p>如果您的构建主机不符合以上三个版本要求中的任何一个，则可以采取一些步骤来设置系统，以便仍可使用Yocto项目。有关信息，请参考Yocto项目参考手册中的“ <a class="ulink" href="http://www.yoctoproject.org/docs/2.5/ref-manual/ref-manual.html#required-git-tar-and-python-versions" target="_top">必需的Git，tar和Python版本</a> ”部分。
                    </p></li></ul></div><p>
        </p></div><div class="section" title="构建主机包"><div class="titlepage" xmlns=""><div><div><h2 class="title" xmlns="http://www.w3.org/1999/xhtml" style="clear:both"><a id="brief-build-system-packages"></a>构建主机需要安装的包<span class="permalink"><a alt="永久链接" title="永久链接" href="https://www.yoctoproject.org/docs/2.5/brief-yoctoprojectqs/brief-yoctoprojectqs.html#brief-build-system-packages">¶</a></span></h2></div></div></div><p>您必须在您的构建主机上安装基本主机软件包。以下命令根据Ubuntu发行版安装主机软件包：</p><div class="note" title="注意" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3>关于所有受支持Linux发行版的主机软件包要求，请参考“Yocto项目参考手册”中的“ <a class="ulink" href="http://www.yoctoproject.org/docs/2.5/ref-manual/ref-manual.html#required-packages-for-the-host-development-system" target="_top">主机开发系统的必需软件包</a> ”部分。
            </div><p>
            </p><pre class="literallayout">$ sudo apt-get install gawk wget git-core diffstat unzip texinfo gcc-multilib \ build-essential chrpath socat cpio python python3 python3 -pip python3-pexpect xz-utils debianutils iputils -sys libsdl1.2-dev xterm</pre><p>
        </p></div><div class="section" title="使用Git克隆Poky"><div class="titlepage" xmlns=""><div><div><h2 class="title" xmlns="http://www.w3.org/1999/xhtml" style="clear:both"><a id="brief-use-git-to-clone-poky"></a>使用git克隆Poky<span class="permalink"><a alt="永久链接" title="永久链接" href="https://www.yoctoproject.org/docs/2.5/brief-yoctoprojectqs/brief-yoctoprojectqs.html#brief-use-git-to-clone-poky">¶</a></span></h2></div></div></div><p>完成机器的设置指令后，您需要在主机上获得Poky仓库。使用以下命令克隆Poky仓库，然后checkout 出 yocto-2.5版本：</p><pre class="literallayout">
     $ git clone git://git.yoctoproject.org/poky
     Cloning into 'poky'...
     remote: Counting objects: 361782, done.
     remote: Compressing objects: 100% (87100/87100), done.
     remote: Total 361782 (delta 268619), reused 361439 (delta 268277)
     Receiving objects: 100% (361782/361782), 131.94 MiB | 6.88 MiB/s, done.
     Resolving deltas: 100% (268619/268619), done.
     Checking connectivity... done.
     $ git checkout tags/yocto-2.5 -b my-yocto-2.5
            </pre><p>Git checkout 命令会创建一个名为my-yocto-2.5的本地分支。在Yocto Project 2.5版本发布时，该分支中可用的文件与“sumo”开发分支中的仓库文件完全匹配。
        </p><p>有关访问Yocto项目相关仓库的更多选项和信息，请参考Yocto项目开发任务手册中的“ <a class="ulink" href="http://www.yoctoproject.org/docs/2.5/dev-manual/dev-manual.html#locating-yocto-project-source-files" target="_top">查找Yocto项目源文件</a> ”部分。
        </p></div><div class="section" title="建立你的形象"><div class="titlepage" xmlns=""><div><div><h2 class="title" xmlns="http://www.w3.org/1999/xhtml" style="clear:both"><a id="brief-building-your-image"></a>创建你的镜像<span class="permalink"><a alt="永久链接" title="永久链接" href="https://www.yoctoproject.org/docs/2.5/brief-yoctoprojectqs/brief-yoctoprojectqs.html#brief-building-your-image">¶</a></span></h2></div></div></div><p>使用以下步骤构建您的镜像。构建过程从源代码创建一个包括工具链的完整Linux发行版，。
            </p><div class="note" title="注意" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>如果您正在防火墙后面工作，并且您的构建主机未设置代理服务器，则在获取源代码时，您可能会遇到构建过程中的问题（例如，获取代码失败或Git clone 失败）。
                        </p></li><li class="listitem"><p>如果您不知道如何设置代理，请咨询您的本地网络管理员获取相关信息。一个好的起点是检查你的网页浏览器设置。最后，您可以在Yocto项目Wiki 中找到有关“ <a class="ulink" href="https://wiki.yoctoproject.org/wiki/Working_Behind_a_Network_Proxy" target="_top">如何在代理网络之后工作</a> ”的更多信息。
                        </p></li></ul></div></div><p>
        </p><p>
            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                    <span class="emphasis"><em>初始化构建环境：</em></span>运行<a class="ulink" href="http://www.yoctoproject.org/docs/2.5/ref-manual/ref-manual.html#structure-core-script" target="_top"><code class="filename">oe-init-build-env</code></a>环境设置脚本，在构建主机上定义Yocto Project的构建环境。
                    </p><pre class="literallayout">$ source oe-init-build-env</pre><p>除此之外，该脚本还会在<a class="ulink" href="http://www.yoctoproject.org/docs/2.5/ref-manual/ref-manual.html#source-directory" target="_top">源码文件夹中</a>创建<a class="ulink" href="http://www.yoctoproject.org/docs/2.5/ref-manual/ref-manual.html#build-directory" target="_top">build 文件夹</a> 。脚本运行后，您的当前工作文件夹会被设置为build。稍后，构建完成时，build文件夹将包含构建期间创建的所有文件。
                    </p></li><li class="listitem"><p><a id="conf-file-step"></a> <span class="emphasis"><em>检查您的本地配置文件：</em></span>设置构建环境时，会在build/conf文件夹下生成一个<code class="filename">local.conf</code>的配置文件。对于这个例子，默认构建目标设置为适合模拟器运行的<code class="filename">qemux86</code>。使用的包管理器设置为RPM包管理器。
                    </p><div class="tip" title="小费" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">提示</h3>通过使用镜像仓库可以显着加快构建并防止获取源码失败。要使用镜像仓库，请将下面这些行添加到Build文件夹中的<code class="filename">local.conf</code>文件中：<pre class="literallayout">
     SSTATE_MIRRORS = "\
     file://.* http://sstate.yoctoproject.org/dev/PATH;downloadfilename=PATH \n \
     file://.* http://sstate.yoctoproject.org/2.4/PATH;downloadfilename=PATH \n \
     file://.* http://sstate.yoctoproject.org/2.5/PATH;downloadfilename=PATH \n \
     "
                        </pre>前面的例子展示了如何为Yocto Project 2.4,2.5和开发区域添加sstate路径。有关sstate路径的完整索引，请参考<a class="ulink" href="http://sstate.yoctoproject.org/" target="_top">http://sstate.yoctoproject.org/</a> 。</div><p>
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>开始构建：</em></span>继续使用以下命令为构建目标OS映像，在此示例中为<code class="filename">core-image-sato</code> ：</p><pre class="literallayout">$ bitbake core-image-sato</pre><p>有关使用<code class="filename">bitbake</code>命令的信息，请参考Yocto项目概述和概念手册中的 <a class="ulink" href="http://www.yoctoproject.org/docs/2.5/overview-manual/overview-manual.html#usingpoky-components-bitbake" target="_top">BitBake</a>的部分，或参考BitBake用户手册中的“ <a class="ulink" href="http://www.yoctoproject.org/docs/2.5/bitbake-user-manual/bitbake-user-manual.html#bitbake-user-manual-command" target="_top">BitBake命令</a>”一节。
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>使用QEMU模拟器运行镜像：</em></span>建立此特定镜像后，您可以启动QEMU，它是Yocto项目附带的Quick EMUlator：</p><pre class="literallayout">$ runqemu qemux86</pre><p>如果您想了解有关运行QEMU的更多信息，请参考Yocto项目开发任务手册中的“ <a class="ulink" href="http://www.yoctoproject.org/docs/2.5/dev-manual/dev-manual.html#dev-manual-qemu" target="_top">使用Quick EMUlator（QEMU）</a> ”一章。
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>退出QEMU：</em></span>通过单击关闭图标或从窗口中输入<code class="filename">Ctrl-C</code>退出QEMU。</p></li></ol></div><p>
        </p></div><div class="section" title="为特定硬件定制你的版本"><div class="titlepage" xmlns=""><div><div><h2 class="title" xmlns="http://www.w3.org/1999/xhtml" style="clear:both"><a id="customizing-your-build-for-specific-hardware"></a>为特定硬件定制你的构建<span class="permalink"><a alt="永久链接" title="永久链接" href="https://www.yoctoproject.org/docs/2.5/brief-yoctoprojectqs/brief-yoctoprojectqs.html#customizing-your-build-for-specific-hardware">¶</a></span></h2></div></div></div><p>到目前为止，您所做的只是快速构建适合仿真的镜像。本节介绍如何通过在Yocto项目开发环境中添加硬件层来为特定硬件定制构建。
        </p><p>一般而言，Layers 是包含相关命令和配置集合的仓库，告诉Yocto项目该做什么。将相关的metadata分离为功能特定的层可以促进模块化开发，并且可以更轻松地重用Layer &amp; metadata。
            </p><div class="note" title="注意" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3>按照惯例，Layer名称以字符串“meta-”开头。
            </div><p>
        </p><p>按照以下步骤添加硬件层：</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
                    <span class="emphasis"><em>查找Layer：</em></span>存在大量硬件Layer。Yocto项目<a class="ulink" href="http://git.yoctoproject.org" target="_top">源码仓库</a>有许多硬件层。这个例子添加了<a class="ulink" href="https://github.com/kraj/meta-altera" target="_top">meta-altera</a>硬件层。
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>使用Git克隆Layer</em></span>到本地。您可以将Layer放在之前创建的Poky仓库的顶层文件夹：</p><pre class="literallayout">
     $ cd ~/poky
     $ git clone https://github.com/kraj/meta-altera.git
     Cloning into 'meta-altera'...
     remote: Counting objects: 25170, done.
     remote: Compressing objects: 100% (350/350), done.
     remote: Total 25170 (delta 645), reused 719 (delta 538), pack-reused 24219
     Receiving objects: 100% (25170/25170), 41.02 MiB | 1.64 MiB/s, done.
     Resolving deltas: 100% (13385/13385), done.
     Checking connectivity... done.
                    </pre><p>现在硬件层与构建主机上的Poky参考仓库中像<code class="filename">meta-altera</code>的其他Layer和metadata需要支持intel的Altera。
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>更改配置为特定系统架构的构建：</em></span> <code class="filename">local.conf</code>文件中的<a class="ulink" href="http://www.yoctoproject.org/docs/2.5/ref-manual/ref-manual.html#var-MACHINE" target="_top"><code class="filename">MACHINE</code></a>变量指定了构建的系统架构。对于这个例子，将<code class="filename">MACHINE</code>变量设置为“cyclone5”。使用这些配置： <a class="ulink" href="https://github.com/kraj/meta-altera/blob/master/conf/machine/cyclone5.conf" target="_top">https</a> ： <a class="ulink" href="https://github.com/kraj/meta-altera/blob/master/conf/machine/cyclone5.conf" target="_top">//github.com/kraj/meta-altera/blob/master/conf/machine/cyclone5.conf</a> 。</p><div class="note" title="注意" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3>有关配置构建的更多信息，请参考“ <a class="link" href="https://www.yoctoproject.org/docs/2.5/brief-yoctoprojectqs/brief-yoctoprojectqs.html#conf-file-step">检查您的本地配置文件</a> 章节”。
                    </div><p>
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>将Layer添加到Layer配置文件：</em></span>在构建时必须将Layer其添加到<code class="filename">bblayers.conf</code>文件中，才可以使用Layer，该文件位于<a class="ulink" href="http://www.yoctoproject.org/docs/2.5/ref-manual/ref-manual.html#build-directory" target="_top">build文件夹的</a> <code class="filename">conf</code>目录中。</p><p>使用<code class="filename">bitbake-layers add-layer</code>命令将<code class="filename">Layer</code>添加到配置文件中：</p><pre class="literallayout">
     $ cd ~/poky/build
     $ bitbake-layers add-layer ../meta-altera
     NOTE: Starting bitbake server...
     Parsing recipes: 100% |##################################################################| Time: 0:00:32
     Parsing of 918 .bb files complete (0 cached, 918 parsed). 1401 targets, 123 skipped, 0 masked, 0 errors.
                    </pre><p>您可以在“ <a class="ulink" href="http://www.yoctoproject.org/docs/2.5/dev-manual/dev-manual.html#adding-a-layer-using-the-bitbake-layers-script" target="_top">使用<code class="filename">bitbake-layers</code>脚本添加Layer</a> ”部分中找到有关添加Layer的更多信息。
                    </p></li></ol></div><p>完成这些步骤已将<code class="filename">meta-altera</code> Layer添加到您的Yocto项目开发环境中，并将其配置为为“cyclone5”机器构建。
            </p><div class="note" title="注意" style="margin-left:0.5in;margin-right:0.5in"><h3 class="title">注意</h3>之前的步骤仅用于演示目的。如果您要尝试构建“cyclone5”版本的镜像，则应该阅读Altera <code class="filename">README</code> 。</div><p>
        </p></div><div class="section" title="创建你自己的通用层"><div class="titlepage" xmlns=""><div><div><h2 class="title" xmlns="http://www.w3.org/1999/xhtml" style="clear:both"><a id="creating-your-own-general-layer"></a>创建你自己的通用Layer<span class="permalink"><a alt="永久链接" title="永久链接" href="https://www.yoctoproject.org/docs/2.5/brief-yoctoprojectqs/brief-yoctoprojectqs.html#creating-your-own-general-layer">¶</a></span></h2></div></div></div><p>也许你有需要隔离的应用程序或特定的一组特性？。您可以使用<code class="filename">bitbake-layers create-layer</code>命令创建自己的通用Layer。该工具自动创建Layer ，包含置一个带有<code class="filename">layer.conf</code>配置文件的子目录，一个包含<code class="filename">example.bb</code> recipe的<code class="filename">recipes-example</code>子目录，一个licensing文件和一个<code class="filename">README</code>。</p><p>以下命令运行该工具在<code class="filename">poky</code>目录中创建名为<code class="filename">meta-mylayer</code>的Layer ：</p><pre class="literallayout">
     $ cd ~/poky
     $ bitbake-layers create-layer meta-mylayer
     NOTE: Starting bitbake server...
     Add your new layer with 'bitbake-layers add-layer meta-mylayer'
            </pre><p>有关Layer以及如何创建Layer的更多信息，请参考Yocto项目开发任务手册中的“ <a class="ulink" href="http://www.yoctoproject.org/docs/2.5/dev-manual/dev-manual.html#creating-a-general-layer-using-the-bitbake-layers-script" target="_top">使用<code class="filename">bitbake-layers</code>脚本创建常规Layer</a> ”部分。
        </p></div><div class="section" title="去哪里下一步"><div class="titlepage" xmlns=""><div><div><h2 class="title" xmlns="http://www.w3.org/1999/xhtml" style="clear:both"><a id="brief-where-to-go-next"></a>下一步去哪里<span class="permalink"><a alt="永久链接" title="永久链接" href="https://www.yoctoproject.org/docs/2.5/brief-yoctoprojectqs/brief-yoctoprojectqs.html#brief-where-to-go-next">¶</a></span></h2></div></div></div><p>现在你已经有使用Yocto项目的经验了，你可能会问自己“现在做什么呢？”Yocto项目有许多信息来源，包括网站，维基页面和用户手册：</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                    <span class="emphasis"><em>网站：</em></span> <a class="ulink" href="http://www.yoctoproject.org" target="_top">Yocto项目网站</a>提供背景信息，最新版本，突发新闻，完整开发文档以及访问丰富的Yocto项目开发社区，您可以在其中进行挖掘。
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>开发者Screencast：</em></span> <a class="ulink" href="http://vimeo.com/36450321" target="_top"> Getting Started with the Yocto Project - New Developer Screencast Tutoria</a><a class="ulink" href="http://vimeo.com/36450321" target="_top"></a>为不熟悉Yocto项目但熟悉Linux构建主机的用户提供了一个30分钟的视频。虽然这个视频有点过时，但是这些介绍和基本概念对初学者很有用。
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Yocto项目概述和概念手册：</em></span> <a class="ulink" href="http://www.yoctoproject.org/docs/2.5/overview-manual/overview-manual.html" target="_top">Yocto项目概述和概念手册</a>是开始了解Yocto项目的好地方。本手册向您介绍Yocto项目及其开发环境。该手册还提供了Yocto项目各个方面的概念信息。
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Yocto项目维基百科：</em></span> <a class="ulink" href="https://wiki.yoctoproject.org" target="_top">Yocto项目维基</a>在Yocto项目，发布信息，项目规划和质量保证信息的基础上提供了关于下一步工作的更多信息。
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>Yocto项目邮件列表：</em></span>相关的邮件列表跟别提供讨论，补丁提交和公告。根据关注的方面进分为几个邮件列表。请参考Yocto项目参考手册中的“ <a class="ulink" href="http://www.yoctoproject.org/docs/2.5/ref-manual/ref-manual.html#resources-mailinglist" target="_top">邮件列表</a> ”部分，了解Yocto项目邮件列表的完整列表。
                    </p></li><li class="listitem"><p>
                    <span class="emphasis"><em>链接和其他文档</em></span>的完整列表：Yocto项目参考手册中的“ <a class="ulink" href="http://www.yoctoproject.org/docs/2.5/ref-manual/ref-manual.html#resources-links-and-related-documentation" target="_top">链接和相关文档</a> ”部分提供了所有相关链接和其他用户文档的完整列表。
                    </p></li></ul></div><p>
        </p></div></div></body></html>